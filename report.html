<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£ - MMTS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f0f2f5; }
        .header-bar { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: white; padding: 20px; border-radius: 0 0 20px 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .form-container { max-width: 600px; margin: -30px auto 20px; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .form-label { font-weight: 600; color: #495057; }
        .btn-submit { background: linear-gradient(45deg, #11998e, #38ef7d); border: none; font-weight: bold; }
        .btn-submit:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(56, 239, 125, 0.4); }
    </style>
</head>
<body>

    <div class="header-bar text-center mb-4">
        <div class="container">
            <h3>üìù ‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏° (Service Request)</h3>
            <p class="mb-2">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: <span id="userDisplay" class="badge bg-warning text-dark fs-6">...</span></p>
            
            <div class="mb-3">
                <a href="machines.html" class="btn btn-sm btn-light text-primary fw-bold rounded-pill px-3 shadow-sm">
                    <i class="bi bi-search"></i> ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤/‡∏î‡∏π‡∏£‡∏π‡∏õ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£
                </a>
            </div>

            <button onclick="logout()" class="btn btn-sm btn-outline-light rounded-pill px-3 opacity-75">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
    </div>

    <div class="container">
        <div class="form-container">
            <form id="repairForm" onsubmit="submitTicket(event)">
                
                <div class="mb-3">
                    <label class="form-label"><i class="bi bi-robot"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏µ‡∏¢</label>
                    <select class="form-select form-select-lg" id="machineSelect" required>
                        <option value="" selected disabled>-- ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ --</option>
                        </select>
                </div>

                <div class="mb-3">
                    <label class="form-label"><i class="bi bi-exclamation-triangle"></i> ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ / ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö</label>
                    <textarea class="form-control" id="problemDesc" rows="3" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏µ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏î‡∏±‡∏á, ‡πÑ‡∏ü‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤, ‡πÇ‡∏ã‡πà‡∏Ç‡∏≤‡∏î..." required></textarea>
                </div>

                <div class="mb-3">
                    <label class="form-label"><i class="bi bi-camera"></i> ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                    <input type="file" class="form-control" id="photoInput" accept="image/*">
                    <div class="form-text text-muted">‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏≤‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô</div>
                </div>

                <div class="mb-4">
                    <label class="form-label"><i class="bi bi-speedometer2"></i> ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô</label>
                    <div class="d-flex gap-2">
                        <input type="radio" class="btn-check" name="urgency" id="u1" value="Normal" checked>
                        <label class="btn btn-outline-secondary w-100" for="u1">‡∏õ‡∏Å‡∏ï‡∏¥</label>

                        <input type="radio" class="btn-check" name="urgency" id="u2" value="Urgent">
                        <label class="btn btn-outline-warning text-dark w-100" for="u2">‡∏î‡πà‡∏ß‡∏ô</label>

                        <input type="radio" class="btn-check" name="urgency" id="u3" value="Critical">
                        <label class="btn btn-outline-danger w-100" for="u3">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏¢‡∏∏‡∏î (‡∏î‡πà‡∏ß‡∏ô‡∏°‡∏≤‡∏Å)</label>
                    </div>
                </div>

                <div class="d-grid">
                    <button type="submit" class="btn btn-primary btn-submit btn-lg py-3">üöÄ ‡∏™‡πà‡∏á‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ‡πÄ‡∏ä‡πá‡∏Ñ Login
        const currentUser = localStorage.getItem('mmts_user');
        if (!currentUser) {
            window.location.href = 'login.html';
        }
        document.getElementById('userDisplay').innerText = currentUser;

        // --- Master Data ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£ (‡∏ä‡∏∏‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö machines.html) ‡∏Ñ‡∏£‡∏ö 51 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á ---
        const machines = [
            { id: "MTM-001", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏•‡∏≤‡∏¢‡∏°‡πâ‡∏ß‡∏ô (Uncoiler) - 2.2kw" },
            { id: "MTM-002", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡∏ö‡∏≤‡∏ô‡πÄ‡∏Å‡∏•‡πá‡∏î (Louver) - 11kw" },
            { id: "MTM-003", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡πÅ‡∏õ C-LINE - 3.7kw" },
            { id: "MTM-004", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡∏ï‡∏±‡∏ß Z 150 - 7.5kw" },
            { id: "MTM-005", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ç‡πâ‡∏≤‡∏á - 1.5kw" },
            { id: "MTM-006", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡∏ï‡∏±‡∏ß Z 200 - 11kw" },
            { id: "MTM-007", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡∏ï‡∏±‡∏ß Z 250 - 11kw" },
            { id: "MTM-008", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡πâ‡∏≥‡∏Ñ‡∏£‡∏≠‡∏ö‡∏™‡∏±‡∏ô‡∏à‡∏±‡πà‡∏ß‡∏ã‡∏µ‡πÅ‡∏û‡∏Ñ - 3.7kw" },
            { id: "MTM-009", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡πâ‡∏≥‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ç‡πâ‡∏≤‡∏á‡∏•‡∏≠‡∏ô‡∏ã‡∏µ‡πÅ‡∏û‡∏Ñ - 3.7kw" },
            { id: "MTM-010", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡∏£‡∏≤‡∏á‡∏ô‡πâ‡∏≥ 407 - 2.2kw" },
            { id: "MTM-011", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏±‡∏ö‡πÑ‡∏Æ‡∏î‡∏£‡∏≠‡∏•‡∏¥‡∏Ñ 6m (‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠) - 5.5kw" },
            { id: "MTM-012", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡∏£‡∏≤‡∏á‡∏ô‡πâ‡∏≥‡∏™‡∏±‡∏ô‡∏ï‡∏∞‡πÄ‡∏Ç‡πâ - 0.75kw" },
            { id: "MTM-013", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡∏£‡∏≤‡∏á‡∏ô‡πâ‡∏≥ 457 - 2.2kw" },
            { id: "MTM-014", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡∏•‡∏≠‡∏ô‡∏ã‡∏µ‡πÅ‡∏û‡∏Ñ 750 - 16kw" },
            { id: "MTM-015", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡∏ï‡∏∞‡πÄ‡∏Ç‡πá‡∏ö‡∏Ñ‡∏π‡πà LT-760 - 5.5kw" },
            { id: "MTM-016", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡∏ö‡∏≤‡∏ô‡πÄ‡∏Å‡∏•‡πá‡∏î 2 IN 1 - 0.75kw" },
            { id: "MTM-017", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡πÅ‡∏õ‡∏ã‡∏µ‡πÅ‡∏û‡∏Ñ - 3.7kw" },
            { id: "MTM-018", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ú‡πà‡∏≤‡πÅ‡∏ú‡πà‡∏ô (Slitting) - 0.75kw" },
            { id: "MTM-019", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡πÄ‡∏™‡πâ‡∏ô‡∏£‡∏∞‡πÅ‡∏ô‡∏á‡∏£‡∏±‡πâ‡∏ß 2 IN 1 - 0.75kw" },
            { id: "MTM-020", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡∏•‡∏≠‡∏ô‡∏ú‡∏ô‡∏±‡∏á 4 ‡∏™‡∏±‡∏ô‡∏•‡∏≠‡∏ô - 2.2kw" },
            { id: "MTM-021", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏±‡∏ö‡πÅ‡∏°‡∏ô‡∏ô‡∏ß‡∏• 4.5m" },
            { id: "MTM-022", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡∏ù‡πâ‡∏≤‡πÄ‡∏û‡∏î‡∏≤‡∏ô 16 ‡∏™‡∏±‡∏ô‡∏•‡∏≠‡∏ô - 1.5kw" },
            { id: "MTM-023", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡∏•‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö‡∏™‡∏±‡∏á‡∏Å‡∏∞‡∏™‡∏µ - 11kw" },
            { id: "MTM-024", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡πâ‡∏≥‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ç‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏á - 1.5kw" },
            { id: "MTM-025", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡∏™‡∏≤‡∏°‡∏™‡∏±‡∏ô‡∏•‡∏≠‡∏ô‡∏™‡∏π‡∏á 760 - 5.5kw" },
            { id: "MTM-026", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏±‡πä‡∏°‡∏Ç‡∏≤‡∏Ñ‡∏•‡∏¥‡∏õ‡∏•‡πá‡∏≠‡∏Ñ - 1.5kw" },
            { id: "MTM-027", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏±‡πä‡∏°‡∏•‡∏≤‡∏¢‡∏Ç‡∏≤‡∏Ñ‡∏•‡∏¥‡∏õ‡∏•‡πá‡∏≠‡∏Ñ - 1.1kw" },
            { id: "MTM-028", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏£‡∏≠‡∏ö‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ PU (3 ‡∏™‡∏±‡∏ô‡∏•‡∏≠‡∏ô) - 1.1kw" },
            { id: "MTM-029", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ú‡πà‡∏≤‡πÅ‡∏ú‡πà‡∏ô‡πÅ‡∏ö‡∏ö‡∏°‡∏µ‡∏ü‡∏±‡∏ô‡∏ï‡∏±‡∏î - 0.75kw" },
            { id: "MTM-030", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏£‡∏≠‡∏ö‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ PU (‡∏ï‡∏∞‡πÄ‡∏Ç‡πá‡∏ö‡∏Ñ‡∏π‡πà 760) - 1.1kw" },
            { id: "MTM-031", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡∏•‡∏≠‡∏ô‡∏ï‡∏∞‡πÄ‡∏Ç‡πá‡∏ö‡∏Ñ‡∏π‡πà LT-750 - 5.5kw" },
            { id: "MTM-032", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡∏•‡∏≠‡∏ô‡∏ã‡∏¥‡∏Å‡πÅ‡∏ã‡∏Å - 5.5kw" },
            { id: "MTM-033", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡∏•‡∏≠‡∏ô‡∏£‡∏±‡πâ‡∏ß Buttress Fence - 5.5kw" },
            { id: "MTM-034", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡∏•‡∏≠‡∏ô‡∏£‡∏±‡πâ‡∏ß U Fence - 5.5kw" },
            { id: "MTM-035", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡∏ö‡∏±‡∏ß‡∏ú‡∏ô‡∏±‡∏á - 2.2kw" },
            { id: "MTM-036", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏±‡∏ö‡πÑ‡∏Æ‡∏î‡∏£‡∏≠‡∏•‡∏¥‡∏Ñ 6m (‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°) - 5.5kw" },
            { id: "MTM-037", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏±‡∏ö‡πÅ‡∏°‡∏ô‡∏ô‡∏ß‡∏• 3.5m" },
            { id: "MTM-038", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡πâ‡∏≥‡πÇ‡∏Ñ‡πâ‡∏á ‡∏•‡∏≠‡∏ô 760 - 5.5kw" },
            { id: "MTM-039", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡∏Ñ‡∏£‡∏≠‡∏ö 2 IN 1 - 0.75kw" },
            { id: "MTM-040", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡∏•‡∏≠‡∏ô‡∏û‡∏∑‡πâ‡∏ô Decking Floor - 35kw" },
            { id: "MTM-041", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡∏ú‡∏ô‡∏±‡∏á‡∏£‡∏∞‡πÅ‡∏ô‡∏á‡πÄ‡∏â‡∏µ‡∏¢‡∏á 3 ‡∏™‡∏±‡∏ô - 1.5kw" },
            { id: "MTM-042", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡∏ú‡∏ô‡∏±‡∏á‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ß‡∏á‡∏Å‡∏•‡∏° - 1.5kw" },
            { id: "MTM-043", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡πâ‡∏≥‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ç‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏á Manual" },
            { id: "MTM-044", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡∏ù‡πâ‡∏≤‡πÄ‡∏û‡∏î‡∏≤‡∏ô/‡∏ú‡∏ô‡∏±‡∏á‡∏£‡∏∞‡πÅ‡∏ô‡∏á - 1.5kw" },
            { id: "MTM-045", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡∏ú‡∏ô‡∏±‡∏á‡∏£‡∏∞‡πÅ‡∏ô‡∏á‡πÄ‡∏â‡∏µ‡∏¢‡∏á 2 ‡∏™‡∏±‡∏ô - 2.2kw" },
            { id: "MTM-046", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏ß‡∏ô‡∏ñ‡∏±‡∏á‡∏ô‡πâ‡∏≥‡∏¢‡∏≤ - 0.75kw" },
            { id: "MTM-047", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏ï‡∏±‡∏ß C3 - 7.5kw" },
            { id: "MTM-048", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏±‡∏ô‡∏Ñ‡∏≠‡∏¢‡∏•‡πå‡πÄ‡∏•‡∏≠‡∏£‡πå (Uncoiler) - 2.2kw" },
            { id: "MTM-049", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏£‡∏≠‡∏ö‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ PU (‡∏ï‡∏∞‡πÄ‡∏Ç‡πá‡∏ö‡∏Ñ‡∏π‡πà 760) - 1.1kw" },
            { id: "MTM-050", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏µ‡∏î‡∏£‡∏≤‡∏á‡∏ô‡πâ‡∏≥ 405 - 1.5kw" },
            { id: "MTM-051", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏•‡∏≤‡∏¢‡∏°‡πâ‡∏ß‡∏ô‡πÅ‡∏ö‡∏ö‡πÉ‡∏ä‡πâ‡∏°‡∏∑‡∏≠‡∏´‡∏°‡∏∏‡∏ô" }
        ];

        // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡πÄ‡∏≠‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏™‡πà Dropdown
        const select = document.getElementById('machineSelect');
        machines.forEach(m => {
            let option = document.createElement("option");
            option.value = m.id + " : " + m.name;
            option.text = m.id + " : " + m.name;
            select.appendChild(option);
        });

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ machines.html ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?
        const preSelected = localStorage.getItem('selected_machine_id');
        if (preSelected) {
            // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ option ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ ID ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏•‡∏¢
            for (let i = 0; i < select.options.length; i++) {
                if (select.options[i].value.startsWith(preSelected)) {
                    select.selectedIndex = i;
                    break;
                }
            }
            localStorage.removeItem('selected_machine_id'); // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏¥‡πâ‡∏á
        }

        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ---
        function submitTicket(e) {
            e.preventDefault();

            // ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°
            const machineVal = document.getElementById('machineSelect').value;
            const problemVal = document.getElementById('problemDesc').value;
            const urgencyVal = document.querySelector('input[name="urgency"]:checked').value;
            const photoFile = document.getElementById('photoInput').files[0];

            if(!machineVal) { Swal.fire('‡∏•‡∏∑‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á!', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö', 'warning'); return; }

            // ‡πÅ‡∏¢‡∏Å ID ‡∏Å‡∏±‡∏ö ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (‡πÄ‡∏ä‡πà‡∏ô "MTM-001 : ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á A" -> id="MTM-001", name="‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á A")
            const parts = machineVal.split(" : ");
            const mID = parts[0];
            const mName = parts[1] || machineVal;

            // ‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡πÄ‡∏õ‡πá‡∏ô Base64 (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
            if (photoFile) {
                const reader = new FileReader();
                reader.onloadend = function() {
                    saveToLocalStorage(mID, mName, problemVal, urgencyVal, reader.result);
                }
                reader.readAsDataURL(photoFile);
            } else {
                saveToLocalStorage(mID, mName, problemVal, urgencyVal, null);
            }
        }

        function saveToLocalStorage(id, name, prob, urg, photo64) {
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á Ticket Object
            const newTicket = {
                id: "TK-" + Math.floor(100000 + Math.random() * 900000), // ‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏Ç‡πÉ‡∏ö‡∏á‡∏≤‡∏ô
                date: new Date().toLocaleString('th-TH'),
                machineId: id,
                machineName: name,
                problem: prob,
                urgency: urg,
                photo: photo64,
                reporter: currentUser,
                status: "PENDING", // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                technician: null   // ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡πà‡∏≤‡∏á‡∏£‡∏±‡∏ö
            };

            // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏°‡∏≤ + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà
            const tickets = JSON.parse(localStorage.getItem('mmts_tickets')) || [];
            tickets.push(newTicket);
            localStorage.setItem('mmts_tickets', JSON.stringify(tickets));

            // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
            Swal.fire({
                title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                text: '‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏£‡∏´‡∏±‡∏™‡πÉ‡∏ö‡∏á‡∏≤‡∏ô: ' + newTicket.id,
                icon: 'success',
                confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
            }).then(() => {
                window.location.href = 'dashboard.html'; // ‡πÄ‡∏î‡πâ‡∏á‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Dashboard
            });
        }

        function logout() {
            localStorage.removeItem('mmts_user');
            localStorage.removeItem('mmts_role');
            window.location.href = 'login.html';
        }
    </script>
</body>
</html>